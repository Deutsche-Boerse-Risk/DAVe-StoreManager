version: 2
jobs:
  build:
    working_directory: ~/DAVe-StoreManager
    docker:
      - image: circleci/openjdk:8-jdk
    environment:
      _JAVA_OPTIONS: "-Xms512m -Xmx2048m"
    steps:
      - checkout
      - setup_remote_docker
      - run: |
          # store our env variables
          set | grep ^DOCKER > /tmp/env.list
          docker run -d -it --name dave --env-file /tmp/env.list --volumes-from src -w /DAVe-StoreManager circleci/openjdk:8-jdk /bin/bash
          docker cp ~/DAVe-StoreManager/ dave:~/
          docker cp $DOCKER_CERT_PATH dave:/tmp
          docker exec dave sh -c "chown -R circleci.circleci /tmp/$DOCKER_CERT_PATH"
          docker exec dave sh -c "chown -R circleci.circleci ~/DAVe-StoreManager"
          docker exec dave sh -c "cd ~/DAVe-StoreManager && mvn -B clean verify"

#          # creating dummy container which will hold a volume with sources
#          docker create -v /DAVe-StoreManager --name src circleci/openjdk:8 /bin/true
#          # copying sources into this volume
#          docker cp ~/DAVe-StoreManager src:/
#          # copying docker certs into this volume
#          docker cp $DOCKER_CERT_PATH src:/tmp
#          # starting application container using this volume
#          docker run --env-file /tmp/env.list --volumes-from src -w /DAVe-StoreManager circleci/openjdk:8-jdk sh -c "cp -R . ~/DAVe-StoreManager && cd ~/DAVe-StoreManager && mvn -B clean verify"
